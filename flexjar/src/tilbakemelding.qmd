:::: {.section-even}
::: {.section-content}

```{=html}
<div class="flexjarcontainer" id="eposttilbakemelding">
    <h3>Vi ønsker din tilbakemelding</h3>
    <p style="font-size: 16px">
        Send en tilbakemelding til oss på: christina.gronhaug@nav.no
    </p>
</div>

<div class="flexjarcontainer" id="flexform">
    <h3>Vi ønsker din tilbakemelding</h3>
        <div id="sendForm">
            <p style="font-size: 16px">
                Fant du den informasjonen du trengte?
            </p>
        <div class="buttons">
            <button id="yesButton">Ja</button>
            <button id="noButton">Nei</button>
        </div>
            <div id="additionalContent"></div>
        </div>
        <div id="thanksResponse">
            <p style="font-weight: 500">Takk for tilbakemeldingen <p>
            <img src="flexjar/src/icons/FaceSmile.svg">
        </div>
</div>

<script>

    const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
    });

    if (location.hostname === 'data.intern.nav.no' && params.debug === null) {
        document.getElementById("flexform").style.display = "none";
    } else {
        document.getElementById("eposttilbakemelding").style.display = "none";
    }
    document.getElementById('yesButton').addEventListener('click', function() {
        showAdditionalContent('Ja');
    });
    document.getElementById('noButton').addEventListener('click', function() {
        showAdditionalContent('Nei');
    });

    function showAdditionalContent(buttonValue) {
        var additionalContent = document.getElementById('additionalContent');
        var maxLength = 600;
        additionalContent.innerHTML = `
            <div id="sendtextContainer">
            <p style="font-weight: 500">
                Er det noe du vil trekke frem? (valgfritt)</p>
                    <div id="textareaContainer">
            <textarea id="additionalInput" maxlength="${maxLength}"></textarea>
            <div id="counter">${maxLength} tegn igjen</div>
            </div>
            <button id="sendButton">Send tilbakemelding</button>
            <div id="errorMessage" style="color: red; font-weight: 500">
                En feil førte til at meldingen ikke ble sendt. Vennligst prøv igjen.
            </div>
        `;

        var textarea = document.getElementById('additionalInput');
        var counter = document.getElementById('counter');
        textarea.addEventListener('input', function() {
            var remaining = maxLength - textarea.value.length;
            counter.textContent = remaining + ' tegn igjen';
        });

        var proxyUrl = (location.hostname === 'data.intern.nav.no')
            ? "www.nav.no"
            : "www.ekstern.dev.nav.no"

        sendButton.addEventListener('click', function() {
            var message = textarea.value;
            fetch('https://' + proxyUrl + '/syk/flexjar/api/v1/feedback/azure', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(
                    {
                        feedback: message,
                        svar: buttonValue,
                        app: "styringsinfo-datafortelling",
                        feedbackId: "datafortelling-slutt"
                    })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('En feil førte til at meldingen ikke ble sendt. Vennligst prøv igjen.');
                }
                var sendtextContainer = document.getElementById('sendForm');
                sendtextContainer.style.display = 'none';
                var thanksResponse = document.getElementById('thanksResponse');
                thanksResponse.style.display = 'flex';
            })
            .catch(error => {
                console.error('Error:', error);
                var errorMessageDiv = document.getElementById('errorMessage');
                errorMessageDiv.style.display = 'block';
            });
        });
    }
</script>
```
:::
::::